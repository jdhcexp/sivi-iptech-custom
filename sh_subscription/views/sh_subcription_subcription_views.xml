<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<!-- Search view -->
		<record id="sh_subscription_subscription_search_view" model="ir.ui.view">
			<field name="name">Subscription</field>
			<field name="model">sh.subscription.subscription</field>
			<field name="arch" type="xml">
				<search>
					<field name="sh_partner_id"/>
					<field name="sh_qty"/>
					<field name="sh_subscription_plan_id"/>
					<field name="sh_plan_price"/>
					<field name="sh_source"/>
					<field name="sh_recurrency"/>
					<field name="sh_unit"/>
					<field name="sh_start_date"/>
					<field name="sh_end_date"/>
					<field name="sh_no_of_billing_cycle"/>
					<field name="sh_invoice_count"/>
					<field name="sh_date_of_next_payment"/>
					<field name="sh_last_payment_status" />
					<field name="sh_amount_due" />
					<filter string="plan price" domain="[('sh_plan_price', '>', 10000)]" help="Plan Price Greter than 10000" name="sh_plan_price"/>
					<filter string="plan Number of Cycle" domain="[('sh_no_of_billing_cycle', '>', 5)]" help="plan Number Of cyccle greater than 3" name="sh_no_of_billing_cycle"/>
					<filter string="plan Source Manual" domain="[('sh_source', '=', 'manual')]" help="Plan Source equal to Manual" name="sh_source"/>
					<filter string="plan Source Sale Order" domain="[('sh_source', '=', 'sales_order')]" help="Plan Source equal to Sale Order" name="sh_source"/>
					<filter string="plan Product Quantity" domain="[('sh_qty', '>', 5)]" help="Plan Product Quantity" name="sh_qty"/>
					<filter string="Paid Subscription" domain="[('sh_last_payment_status', '=', 'paid')]" help="Paid Subscription" name="sh_last_payment_status"/>
					<filter string="Unpaid Subscription" domain="[('sh_last_payment_status', '=', 'unpaid')]" help="Unpaid Subscription" name="sh_last_payment_status"/>
					<filter string="Amount Paid Payment in Subscription" domain="[('sh_amount_due', '=', 0)]" help="Amount Paid Payment in Subscription" name="sh_amount_due"/>
					<filter string="Amount Due Payment in Subscription" domain="[('sh_amount_due', '!=', 0)]" help="Amount Due Payment in Subscription" name="sh_amount_due"/>
					<group  expand='0' string='Group by...'>
						<filter string='product' name="product_id" domain="[]" context="{'group_by' : 'product_id'}"/>
						<filter string='subscription plan' name="sh_subscription_plan_id" domain="[]" context="{'group_by' : 'sh_subscription_plan_id'}"/>
						<filter string='Customer' name="sh_partner_id" domain="[]" context="{'group_by' : 'sh_partner_id'}"/>
						<filter string='Source' name="sh_source" domain="[]" context="{'group_by' : 'sh_source'}"/>
						<filter string='Start Date' name="sh_start_date" domain="[]" context="{'group_by' : 'sh_start_date'}"/>
						<filter string='End Date' name="sh_end_date" domain="[]" context="{'group_by' : 'sh_end_date'}"/>
						<filter string='Number Of Billing Cycle' name="sh_no_of_billing_cycle" domain="[]" context="{'group_by' : 'sh_no_of_billing_cycle'}"/>
						<filter string='Date of Next Payment' name="sh_date_of_next_payment" domain="[]" context="{'group_by' : 'sh_date_of_next_payment'}"/>
						<filter string='Plan Trial Unit' name="sh_unit" domain="[]" context="{'group_by' : 'sh_unit'}"/>
						<filter string='Subscription Last Payment Status' name="sh_last_payment_status" domain="[]" context="{'group_by' : 'sh_last_payment_status'}"/>
						<filter string='Amount Due Payment in Subscription' name="sh_amount_due" domain="[]" context="{'group_by' : 'sh_amount_due'}"/>
					</group>
				</search>
			</field>
		</record>
		<!-- Form View -->
		<record id="sh_subscription_subscription_form_view" model="ir.ui.view">
			<field name="name">Subscription</field>
			<field name="model">sh.subscription.subscription</field>
			<field name="arch" type="xml">
				<form string="Subscription">
					<header>
						<button name="sh_subscription_confirm" class="oe_highlight" id="sh_subscription_confirm" string="Confirm" type="object" states="draft"/>
						<button name="sh_subscription.sh_subscription_cancle_wizard_action" string="Cancel" type="action" class="oe_highlight" states="draft" context="{'is_cancel':'True'}"/>
						<button name="sh_subscription.sh_subscription_cancle_wizard_action" string="Close" type="action" states="in_progress" class="oe_highlight" />
						<button name="sh_subscription.sh_subscription_renewed_wizard_action" string="Renew" type="action" class="oe_highlight" attrs="{'invisible': ['|','|',('state', '=','renewed'),('sh_renew_stage', '=','not_time_to_renew'),('state', 'in',['draft'])]}"/>
						<field name="state" widget="statusbar" statusbar_visible="draft,in_progress,cancel"/>
					</header>
					<sheet>
						<div class="oe_button_box" name="button_box">
							<button name="sh_action_view_invoice" type="object" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible': [('sh_invoice_count', '=', 0)]}" >
								<field name="sh_invoice_count" widget="statinfo" string="Invoices"/>
							</button>
						</div>
						<div class="oe_title d-flex">
							<h1>
								<field name="name" attrs="{'invisible':[('name','=',False)]}"/>
							</h1>
						</div>
						<group>
							<field name="active"  attrs="{'readonly': [('state', '!=', 'draft')]}" />
							<field name="sh_renew_stage"  invisible="1" />
							<field name="sh_recurring_monthly" invisible="1"/>
							
						</group>
						<group name="customer">
							<group name="customer" string="Customer Information">
								<field name="sh_partner_id"  attrs="{'readonly': [('state', '!=', 'draft')]}" required="1"/>
								<field name="sh_partner_invoice_id"  attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							</group>
							<group name="product" string="Product Information">
								<field name="product_id"  attrs="{'readonly': [('state', '!=', 'draft')]}" required="1" options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"/>
								<field name="sh_taxes_ids" widget="many2many_tags" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
								<field name="sh_qty"  attrs="{'readonly': [('state', '!=', 'draft')]}" required="1"/>
							</group>
						</group>
						<notebook>
							<page string="Plan Information">
								<group name="plan" string="Plan Information">
									<group>
									<field name="sh_company_id" groups="base.group_multi_company"/>
									<field name="sh_subscription_plan_id" required="1" force_save="1" readonly="1"/>
									<label for="sh_recurrency" string="Recurrency" />
									<div name="sh_recurrency" >
										<span>
											<field name="sh_recurrency" required="1" class="oe_inline" nolabel="1" force_save="1" readonly="1"/>
										</span>
										<span>
											<field name="sh_unit" required="1"  class="oe_inline" nolabel="1" force_save="1" readonly="1"/>
										</span>
									</div>
									<field name="sh_trial" force_save="1" readonly="1"/>
									<field name="sh_trial_end_date" force_save="1" readonly="1" attrs="{'invisible': [('sh_trial_end_date', '=', False)]}"/>
									<label for="sh_trial_duration" string="Trial duration" force_save="1" readonly="1"/>
									<div name="sh_trial_duration" class="d-flex" force_save="1" readonly="1">
										<span>
											<field name="sh_trial_duration" class="oe_inline" nolabel="1" force_save="1" readonly="1"/>
										</span>
										<span>
											<field name="sh_trial_unit" class="oe_inline" nolabel="1" force_save="1" readonly="1"/>
										</span>
									</div>
                                    <field name="sh_reason" attrs="{'invisible': [('sh_reason', '=', False)]}" force_save="1" readonly="1" />
								</group>
                                <group>
									<field name="sh_plan_price" required="1" widget="monetary" options="{'currency_field': 'currency_id'}" force_save="1" readonly="1"/>
									<field name="sh_start_date" required="1" force_save="1" readonly="1"/>
									<field name="sh_end_date" force_save="1" readonly="1"/>
									<field name="sh_no_of_billing_cycle" required="1" force_save="1" readonly="1"/>
								</group>
							</group>
							</page>
							<page string="Payment Information">
								<group name="payment" string="Payment Information">
									<group>
										<field name="currency_id" invisible="1"/>
										<label for="sh_date_of_next_payment"/>
										<div class="o_row">
											<field name="sh_date_of_next_payment" readonly="1" force_save="1"/>
											<button string="Generate Invoice" type="object" name="sh_generate_invoice" class="oe_inline oe_link" attrs="{'invisible': [('state', '!=', 'in_progress')]}"/>
										</div>
										<field name="sh_last_payment_status" />
										<field name="sh_amount_due" />

									</group>
									<group>
										<field name="sh_source" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}" readonly="1" force_save="1"/>
										<field name="sh_subscription_ref" attrs="{'readonly': [('state', '!=', 'draft')]}" readonly="1" force_save="1"/>
										
                                        <field name="sh_order_ref_id" attrs="{'invisible':[('sh_source','=','manual')]}" readonly="1" force_save="1" />
										<field name="sh_subscription_id" attrs="{'invisible':[('sh_subscription_id','=',False)]}" readonly="1" force_save="1"/>
									</group>
								</group>
							</page>
						</notebook>
					</sheet>
					<div class="oe_chatter">
						<field name="message_follower_ids"/>
						<field name="activity_ids"/>
						<field name="message_ids"/>
					</div>
				</form>
			</field>
		</record>
		<!-- List view -->
		<record id="sh_subscription_subscription_tree_view" model="ir.ui.view">
			<field name="name">Subscription</field>
			<field name="model">sh.subscription.subscription</field>
			<field name="arch" type="xml">
				<tree decoration-danger="state == 'expire' or state == 'cancel' or state == 'close' " decoration-info="state == 'draft'" decoration-bf="state == 'in_progress'" decoration-success="state == 'renewed'" string="Subscriptions">
					<field name="name" optional="show"/>
					<field name="sh_partner_id" optional="show"/>
					<field name="sh_partner_invoice_id" optional="hide"/>
					<field name="product_id" optional="show"/>
					<field name="sh_qty" optional="show"/>
					<field name="sh_subscription_plan_id" optional="show"/>
					<field name="sh_recurrency" optional="show"/>
					<field name="sh_unit" widget="show"/>
					<field name="sh_taxes_ids" optional="hide"/>
					<field name="currency_id" invisible="1"/>
					<field name="sh_plan_price" optional="hide" widget="monetary"/>
					<field name="sh_start_date" optional="hide"/>
					<field name="sh_end_date" optional="hide"/>
					<field name="sh_no_of_billing_cycle" optional="hide"/>
					
					<field name="sh_source" optional="hide"/>
					<field name="sh_subscription_ref" optional="hide"/>
					<field name="sh_last_payment_status" optional="show"/>
					<field name="sh_amount_due" optional="hide"/>
					<field name="sh_date_of_next_payment" optional="hide"/>

					<field name="state" optional="show" widget="badge" decoration-danger="state == 'expire' or state == 'cancel' or state == 'close' " decoration-info="state == 'draft'" decoration-bf="state == 'in_progress'" decoration-success="state == 'renewed'"/>
				</tree>
			</field>
		</record>
		<!-- Action -->
		<record id="sh_subscription_subscription_action" model="ir.actions.act_window">
			<field name="name">Subscription</field>
			<field name="res_model">sh.subscription.subscription</field>
			<field name="view_mode">tree,form</field>
		</record>
		<!-- Menu  -->
		<menuitem id="sh_subscription_subscription_menu"
                name="Subscription"
                parent="sale.sale_menu_root"
                action="sh_subscription_subscription_action"
                sequence="30"/>
	</data>
</odoo>
